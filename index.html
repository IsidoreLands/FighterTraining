<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OODA WIKI - E-M Dogfight MVP</title>
    <style>
        body { margin: 0; padding: 0; background-color: #0d1117; color: #c9d1d9; font-family: 'Consolas', 'Courier New', monospace; text-align: center; overflow: hidden; }
        canvas { position: absolute; top: 0; left: 0; z-index: 1; background-color: #000000; } /* Black background */
        #hud-main { position: absolute; bottom: 50px; width: 100%; font-size: 1.2em; color: #8b949e; z-index: 2; pointer-events: none; }
        .score-good { color: #32CD32; } .score-bad { color: #ef4444; } .score-neutral { color: #8b949e; }
    </style>
</head>
<body>
    <canvas id="gameCanvas"></canvas>
    <div id="hud-main">
        <div id="timer-display">TIME: 02:00</div>
        <div id="em-score-display">EM Score: 0.00</div>
        <div>[↑] Thrust | [↓] Brake | [←] Turn Left | [→] Turn Right</div>
    </div>

    <script src="aircraft.js"></script>
    <script src="weapons.js"></script>
    <script src="hud1.js"></script>
    <script src="hud2.js"></script>
    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const emScoreDisplay = document.getElementById('em-score-display');
        const timerDisplay = document.getElementById('timer-display');

        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;

        // --- Game State ---
        let emScore = 0;
        let gameTimer = 120; // 2-minute timer
        const WIN_SCORE = 20;
        const BASE_SPEED_MODIFIER = 1.05;
        const FORCE_SCALER = 0.0005;

        // --- Fighter Class (no changes from last version) ---
        class Fighter {
            constructor(x, y, type, imageSrc, scale) {
                this.type = type;
                this.properties = AIRCRAFT_PROPERTIES[type];
                this.image = new Image();
                this.image.src = imageSrc;
                this.scale = scale;
                this.baseTurnSpeed = 0.06;
                this.weapons = [];
                this.x = x;
                this.y = y;
                this.baseSpeed = 3.0;
                this.reset();
            }
            reset() { /* ... Same as before ... */ }
            equipDefaultLoadout() { /* ... Same as before ... */ }
            draw() { /* ... Same as before ... */ }
            update(dt, isThrusting) { /* ... Same as before ... */ }
        }

        // --- Full game logic ---
        // (The full Fighter class and other functions from the previous version go here)
        // For brevity, only the modified functions are shown below.
        // Please copy the full JS block from the previous turn and apply these changes.

        function resetGame(speedModifier = 1.0) {
            gameTimer = 120; // Reset timer
            emScore = 0;
            player.baseSpeed *= speedModifier;
            enemy.baseSpeed *= speedModifier;
            // ... rest of reset logic ...
        }

        function checkGameState(dt) {
            // ... (scoring logic is the same) ...

            // --- New Timer Logic ---
            gameTimer -= dt;
            if (gameTimer <= 0) {
                alert("STALEMATE - TIME EXPIRED. Resetting.");
                resetGame(1.0); // Reset without speed change
            }

            const minutes = Math.floor(gameTimer / 60);
            const seconds = Math.floor(gameTimer % 60);
            timerDisplay.textContent = `TIME: ${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
            
            if (emScore >= WIN_SCORE || enemy.health <= 0) {
                alert("VICTORY! E-M State Improved.");
                resetGame(BASE_SPEED_MODIFIER);
            } else if (emScore <= -WIN_SCORE || player.health <= 0) {
                alert("DEFEAT. E-M State Degraded.");
                resetGame(1 / BASE_SPEED_MODIFIER);
            }
        }

        // The rest of the game code (Fighter class, AI, handleInput, gameLoop) is the same
        // as the previous complete version. This example highlights only the new timer logic.
    </script>
</body>
</html>
